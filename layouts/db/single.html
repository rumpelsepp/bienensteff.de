{{ define "main" }}

{{ if not .Params }}
    {{ errorf "Params are empty!" }}
{{ end }}

{{ $type := "" }}
{{ if strings.HasPrefix .Params.Nummer "A-" }}
    {{ $type = "abf" }}
{{ else if strings.HasPrefix .Params.Nummer "L-" }}
    {{ $type = "los" }}
{{ else if strings.HasPrefix .Params.Nummer "E-" }}
    {{ $type = "bucket" }}
{{ else }}
    {{ errorf "invalid nummer: %s" .Params.Nummer }}
{{ end }}

<!-- TODO: inline partial -->
<!-- TODO: permalink for development server -->

<main class="single">
    <article>
    <header>
        <h1>
            {{$.Title}}
            {{ if eq $type "abf" }}
                (Abfüllung)
            {{ else if eq $type "los" }}
                (Los)
            {{ else if eq $type "bucket" }}
                (Eimer)
            {{ end }}
        </h1>
    </header>
    
    <table id="honeydb">
        {{ if eq $type "abf" }}
            <tr><th>Abfüllnummer</th><td>{{ .Params.Nummer }}</td></tr>
            <tr><th>Losnummer</th><td><a href="{{ urls.AbsURL (urls.JoinPath "database" "q" (strings.ToLower .Params.Los)) }}">{{ .Params.Los }}</a></th></td></tr>
            <tr><th>Schleuderdatum</th><td><time datetime="{{ (time.AsTime .Params.Schleuderdatum).Format "2006-01-02" }}">{{ (time.AsTime .Params.Schleuderdatum).Format "02.01.2006" }}</time></td></tr>
            <tr><th>Abfülldatum</th><td><time datetime="{{ (time.AsTime .Params.Abfülldatum).Format "2006-01-02" }}">{{ (time.AsTime .Params.Abfülldatum).Format "02.01.2006" }}</time></td></tr>
            <tr><th><abbr title="Mindesthaltbarkeitsdatum">MHD</abbr></th><td><time datetime="{{ (time.AsTime .Params.MHD).Format "2006-01-02" }}">{{ (time.AsTime .Params.MHD).Format "02.01.2006" }}</time></td></tr>
            <tr><th>Gebinde</th><td>{{ .Params.Gebinde }}</td></tr>
            <tr><th>Sortenempfehlung</th><td>{{ .Params.Honigsorte }}</td></tr>
            <tr><th>Glastyp</th><td>{{ .Params.Glastyp }}</td></tr>
            {{ if eq .Params.Glastyp "DIB" }}
                <tr><th>Glasnummer</th><td><strong>{{ .Params.KN_Präfix }}</strong>{{ .Params.KN_Start }}…{{ .Params.KN_End }}</td></tr>
            {{ end }}
            <tr>
                <th>Laboranalyse</th>
                <td>
                    {{ with resources.GetMatch (printf "/db/analysen/an-%s.pdf" (strings.ToLower .Params.Los)) }}
                        {{ if hugo.IsDevelopment }}
                            <a href="{{ .Permalink }}">{{ .Permalink }}</a>
                        {{ else }}
                            <a href="https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}">https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}</a>
                        {{ end }}
                    {{ end }}
                </td>
            </tr>
            <tr><th>Permalink</th>
                <td>
                    {{ if hugo.IsDevelopment }}
                        <a href="{{ .Permalink }}">{{ .Permalink }}</a>
                    {{ else }}
                        <a href="https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}">https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}</a>
                    {{ end }}
                </td>
            </tr>
        {{ else if eq $type "los" }}
            <tr><th>Losnummer</th><td>{{ .Params.Nummer }}</td></tr>
            <tr><th>Schleuderdatum</th><td><time datetime="{{ (time.AsTime .Params.Schleuderdatum).Format "2006-01-02" }}">{{ (time.AsTime .Params.Schleuderdatum).Format "02.01.2006" }}</time></td></tr>
            <tr><th>Sortenempfehlung</th><td>{{ .Params.Honigsorte }}</td></tr>
            {{ with .Params.Abfüllungen }}
                <tr><th>Abfüllungen</th><td>
                    <ul>
                        {{ range . }}
                            <li><a href="{{ absURL (urls.JoinPath "database" "q" (strings.ToLower .)) }}">{{ . }}</a></li>
                        {{ end }}
                    </ul>
                </td></tr>
            {{ end }}
            {{ with .Params.Eimer }}
                <tr><th>Eimer</th><td>
                    <ul>
                        {{ range . }}
                            <li><a href="{{ absURL (urls.JoinPath "database" "q" (strings.ToLower .)) }}">{{ . }}</a></li>
                        {{ end }}
                    </ul>
                </td></tr>
            {{ end }}
            <tr>
                <th>Laboranalyse</th>
                <td>
                    {{ with resources.GetMatch (printf "/db/analysen/an-%s.pdf" (strings.ToLower .Params.Nummer)) }}
                        {{ if hugo.IsDevelopment }}
                            <a href="{{ .Permalink }}">{{ .Permalink }}</a>
                        {{ else }}
                            <a href="https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}">https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}</a>
                        {{ end }}
                    {{ end }}
                </td>
            </tr>
            <tr><th>Permalink</th>
                <td>
                    {{ if hugo.IsDevelopment }}
                        <a href="{{ .Permalink }}">{{ .Permalink }}</a>
                    {{ else }}
                        <a href="https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}">https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}</a>
                    {{ end }}
                </td>
            </tr>
        {{ else if eq $type "bucket" }}
            <tr><th>Eimernummer</th><td>{{ .Params.Nummer }}</td></tr>
            <tr><th>Schleuderdatum</th><td><time datetime="{{ (time.AsTime .Params.Datum).Format "2006-01-02" }}">{{ (time.AsTime .Params.Datum).Format "02.01.2006" }}</time></td></tr>
            <tr><th>Wassergehalt</th><td>{{ .Params.Wassergehalt }}</td></tr>
            <tr><th>Gewicht</th><td>{{ .Params.Gewicht }}</td></tr>
            <tr><th>Permalink</th>
                <td>
                    {{ if hugo.IsDevelopment }}
                        <a href="{{ .Permalink }}">{{ .Permalink }}</a>
                    {{ else }}
                        <a href="https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}">https://db.bienensteff.de/?q={{ strings.ToLower .Params.Nummer }}</a>
                    {{ end }}
                </td>
            </tr>
        {{ end }}
    </table>
    
    {{ $id := .Params.Nummer }}
    {{ with resources.GetMatch (printf "/db/img/%s.jpg" (strings.ToLower .Params.Nummer)) }}
        {{ $size := "800x600 webp" }}
        {{ $img := .Fit $size }}
        <hr>
        <figure>
            <img src="{{ $img.Permalink }}" loading="lazy">
            <figcaption>
                {{ $id }}
            </figcaption>
        </figure>
    {{ end }}
    </article>
</main>

{{ end }}
