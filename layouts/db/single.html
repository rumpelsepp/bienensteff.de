{{ define "partials/inline-permalink.html" }}
    <tr><th>Permalink</th>
        <td>
            {{ if hugo.IsDevelopment }}
                <a href="{{ .Permalink }}">{{ .Permalink }}</a>
            {{ else }}
                <a href="https://db.bienensteff.de/?q={{ strings.ToLower .Params.id }}">https://db.bienensteff.de/?q={{ strings.ToLower .Params.id }}</a>
            {{ end }}
        </td>
    </tr>
{{ end }}

{{ define "partials/inline-analysis-permalink.html" }}
    {{ with resources.GetMatch (printf "/db/analysen/an-%s.pdf" (strings.ToLower .)) }}
    <tr>
        <th>Laboranalyse</th>
        <td>
            {{ if hugo.IsDevelopment }}
                <a href="{{ .Permalink }}">{{ .Permalink }}</a>
            {{ else }}
                <!-- This is needed to force hugo to copy the files: {{ .Permalink }} -->
                <a href="https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}">https://db.bienensteff.de/?q={{ strings.ToLower (strings.TrimPrefix "/db/analysen/" .Title) }}</a>
            {{ end }}
        </td>
    </tr>
    {{ end }}
{{ end }}

{{ define "main" }}

{{ if not .Params }}
    {{ errorf "Params are empty!" }}
{{ end }}

{{ $type := "" }}
{{ if strings.HasPrefix .Params.id "SKU-" }}
    {{ $type = "article" }}
{{ else if strings.HasPrefix .Params.id "L-" }}
    {{ $type = "batch" }}
{{ else if strings.HasPrefix .Params.id "E-" }}
    {{ $type = "bucket" }}
{{ else if strings.HasPrefix .Params.id "S-" }}
    {{ $type = "centrifugation" }}
{{ else if strings.HasPrefix .Params.id "A-" }}
    {{ $type = "filling" }}
{{ else }}
    {{ errorf "invalid nummer: %s" .Params.id }}
{{ end }}

<!-- TODO: inline partial -->
<!-- TODO: permalink for development server -->

<main class="single">
    <article class="content">
    <header>
        <h1>
            {{ if eq $type "article" }}
                {{ .Params.label }}
            {{ else if eq $type "batch" }}
                {{ $.Title }}
                (Los)
            {{ else if eq $type "bucket" }}
                {{ $.Title }}
                (Eimer)
            {{ else if eq $type "centrifugation" }}
                {{ $.Title }}
                (Schleuderung)
            {{ else if eq $type "filling" }}
                {{ $.Title }}
                (Abf√ºllung)
            {{ end }}
        </h1>
    </header>
    
    <table id="honeydb" class="table table-sm table-striped table-bordered">
        {{ if eq $type "article" }}
            {{ partial "db/single_article.html" . }}
            {{ partial "inline-permalink.html" . }}
        {{ end }}
        {{ if eq $type "batch" }}
            {{ partial "db/single_batch.html" . }}
            {{ partial "inline-analysis-permalink.html" .Params.id }}
            {{ partial "inline-permalink.html" . }}
        {{ else if eq $type "bucket" }}
            {{ partial "db/single_bucket.html" . }}
            {{ partial "inline-permalink.html" . }}
        {{ else if eq $type "centrifugation" }}
            {{ partial "db/single_centrifugation.html" . }}
            {{ partial "inline-permalink.html" . }}
        {{ else if eq $type "filling" }}
            {{ partial "db/single_filling.html" . }}
            {{ partial "inline-permalink.html" . }}
        {{ end }}
    </table>

    {{ if or (eq $type "batch") (eq $type "bucket") }}
        <div class="card">
            <div class="card-header">Hinweis zum Wassergehalt üí°ü§î</div>
            <div class="card-body">
                Die angegebenen Werte entsprechen einer Eigenmessung basierend auf einer zuf√§lligen Stichprobe.
                Diese Werte geben einen groben Anhaltspunkt, stellen aber keine verl√§ssliche Aussage √ºber den tats√§chlichen Wassergehalt dar.
                Der verl√§sslichste Wert ist der Laborwert einer Probe die aus einem homogenisierten Los stammt.
                Zur Homogenisierung orientieren wir uns an den <a href="https://www.lwg.bayern.de/mam/cms06/bienen/dateien/qualit%C3%A4tskontrolle_honig_und_probennahme_tgd_2021.pdf">Richtlinien</a> des Tiergesundheitsdienst Bayern.
                Sofern vorhanden, sind die jeweiligen Analysen in der obigen Tabelle verlinkt.
            </div>
        </div>
    {{ end }}
    
    {{ $id := .Params.id }}
    {{ with resources.GetMatch (printf "/db/img/%s.jpg" (strings.ToLower .Params.id)) }}
        <hr>
        <figure class="figure">
            <img class="figure-img img-fluid rounded" src="{{ .RelPermalink }}" loading="lazy">
            <figcaption class="figure-caption">
                {{ $id }}
            </figcaption>
        </figure>
    {{ end }}
    </article>
</main>

{{ end }}
